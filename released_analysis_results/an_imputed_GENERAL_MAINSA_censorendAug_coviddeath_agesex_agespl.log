------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\covid-vs-noncovid-deaths-research\analysis/output/an_imputed_GENERAL_MAINSA_censorendAug_coviddeath_agesex_agespl.log
  log type:  text
 opened on:  22 Feb 2021, 16:57:44

. 
. use ./analysis/an_impute_imputeddata_`dataset', replace

. 
. if "`5'"=="SA_anywhereonDC"{
.         replace coviddeath = 1 if onsdeath>=1 & onsdeath<. & died_ons_covid_flag_any==1
.         replace noncoviddeath = 0 if died_ons_covid_flag_any==1
. }

. 
. if "`5'"=="SA_u071only"{
.         replace coviddeath = 0 if died_ons_covidconf_flag_und!=1
.         replace noncoviddeath = 1 if onsdeath>=1 & onsdeath<. & died_ons_covidconf_flag_und!=1
. }

. 
. if "`5'"=="SA_censorendAug"{
.         replace coviddeath = 0 if coviddeath==1 & stime_onsdeath>d(1/9/2020)
(2,418 real changes made)
.         replace noncoviddeath = 0 if noncoviddeath==1 & stime_onsdeath>d(1/9/2020)
(30,752 real changes made)
. }

. 
. if "`outcome'"=="deathsonlyCvN"{
.         drop if !(onsdeath>=1&onsdeath<.)
.         gen deathsonlyCvN = (coviddeath==1)
. }

. 
. tab `outcome'

 coviddeath |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 17,441,870       99.92       99.92
          1 |     14,645        0.08      100.00
------------+-----------------------------------
      Total | 17,456,515      100.00

. 
. if "`modeltorun'"=="agesex_cox"{
.         gen onsdeath_cnc = onsdeath
.         recode onsdeath_cnc 2/6=2
.         if "`outcome'"=="coviddeath" local outcomenum = 1
.         else if "`outcome'"=="noncoviddeath" local outcomenum = 2
.         mi stset stime_onsdeath, fail(onsdeath_cnc==`outcomenum') id(patient_id) enter(enter_date) origin(enter_date)
.         mi estimate, eform post: stcox age1 age2 age3 male i.ethnicity, strata(stp)
.         estimates save ./analysis/output/models/an_imputed_agesex_`dataset'SA_Cox_`outcome', replace
.         drop if !(onsdeath>=1&onsdeath<.)
.         gen deathsonlyCvN = (coviddeath==1)
. }

.                 
. if "`modeltorun'"=="agesex"{
. *Age-sex model
. mi estimate, eform post: logistic `outcome' age1 age2 age3 i.male i.stp i.ethnicity 

Multiple-imputation estimates                   Imputations       =         10
Logistic regression                             Number of obs     = 17,456,515
                                                Average RVI       =     0.0373
                                                Largest FMI       =     0.3825
DF adjustment:   Large sample                   DF:     min       =      67.73
                                                        avg       =   1.34e+09
                                                        max       =   2.94e+09
Model F test:       Equal FMI                   F(  39,253414.2)  =     758.13
Within VCE type:          OIM                   Prob > F          =     0.0000

-----------------------------------------------------------------------------------------
             coviddeath |     exp(b)   Std. Err.      t    P>|t|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
                   age1 |   1.170473   .0225339     8.18   0.000     1.127131    1.215483
                   age2 |   .9101054   .0379526    -2.26   0.024     .8386784    .9876155
                   age3 |   1.264058   .1217311     2.43   0.015     1.046633    1.526649
                 1.male |   1.686422   .0284384    30.99   0.000     1.631595    1.743092
                        |
                    stp |
                     2  |   .4038762   .2880769    -1.27   0.204     .0997937    1.634532
                     3  |   .2945883   .2103335    -1.71   0.087     .0726884    1.193895
                     4  |   .5493303    .393527    -0.84   0.403     .1349128    2.236732
                     5  |   .5065742   .3637074    -0.95   0.344     .1240229    2.069113
                     6  |   .4294267   .3064727    -1.18   0.236     .1060241    1.739296
                     7  |    .496006   .3590198    -0.97   0.333     .1200519    2.049297
                     8  |   .4142006   .2956782    -1.23   0.217       .10223    1.678198
                     9  |   .1305904    .093566    -2.84   0.004     .0320656    .5318434
                    10  |   .3555985   .2538897    -1.45   0.148     .0877446    1.441118
                    11  |    .347757   .2482914    -1.48   0.139     .0858095    1.409342
                    12  |   .5442825   .3892568    -0.85   0.395     .1339883    2.210965
                    13  |   .4590886   .3279808    -1.09   0.276     .1131836    1.862128
                    14  |   .4778234   .3413273    -1.03   0.301     .1178208    1.937817
                    15  |   .2712499    .193847    -1.83   0.068     .0668442    1.100716
                    16  |   .1894076   .1353531    -2.33   0.020     .0466786    .7685589
                    17  |   .2827255   .2019809    -1.77   0.077     .0697045     1.14675
                    18  |   .4672208    .333516    -1.07   0.286     .1153213    1.892932
                    19  |   .3988852   .2848262    -1.29   0.198     .0984108    1.616788
                    20  |   .4122901    .294209    -1.24   0.214     .1018094    1.669621
                    21  |     .49428   .3527486    -0.99   0.323     .1220403    2.001902
                    22  |   .4459019   .3235808    -1.11   0.266      .107533       1.849
                    23  |   .2241536   .1601477    -2.09   0.036     .0552586    .9092663
                    24  |   .4391663   .3200532    -1.13   0.259     .1052677    1.832158
                    25  |   .1181742   .0854171    -2.95   0.003     .0286595    .4872781
                    26  |   .0932364   .0668291    -3.31   0.001     .0228807    .3799282
                    27  |   .2683017   .1916409    -1.84   0.065     .0661656    1.087964
                    28  |   .1185462   .0848521    -2.98   0.003     .0291488     .482119
                    29  |   .2173543   .1554989    -2.13   0.033     .0534816    .8833484
                    30  |   .3423453   .2447028    -1.50   0.134     .0843412    1.389598
                    31  |   .2577622   .1962988    -1.78   0.075     .0579411    1.146705
                    32  |   .4451213   .3175148    -1.13   0.256     .1099759    1.801603
                        |
              ethnicity |
                 Mixed  |   1.607476   .1876385     4.07   0.000     1.277483    2.022712
Asian or Asian British  |   1.783665   .0786586    13.12   0.000     1.633402    1.947752
                 Black  |   1.872886     .11981     9.81   0.000     1.650494    2.125244
                 Other  |   1.376919   .1269122     3.47   0.001     1.147242    1.652578
                        |
                  _cons |   1.46e-07   1.46e-07   -15.74   0.000     2.06e-08    1.04e-06
-----------------------------------------------------------------------------------------
. estimates save ./analysis/output/models/an_imputed_agesex_`dataset'`sensan'_`outcome', replace
(note: file ./analysis/output/models/an_imputed_agesex_MAINSA_censorendAug_coviddeath.ster not found)
file ./analysis/output/models/an_imputed_agesex_MAINSA_censorendAug_coviddeath.ster saved
. }

. 
. if "`modeltorun'"=="full"{
. *Full model
. mi estimate, eform post: logistic `outcome' ///
>                         `age'                                                   ///
>                         i.male                                                  ///
>                         i.obese4cat                                             ///
>                         i.smoke_nomiss                                  ///
>                         i.ethnicity                                             ///
>                         i.imd                                                   ///
>                         i.htdiag_or_highbp                              ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthmacat                                             ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabcat                                               ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke                                                ///     
>                         i.dementia                                              ///
>                         i.other_neuro                                   ///
>                         i.reduced_kidney_function_cat2  ///
>                         i.organ_transplant                              ///
>                         i.spleen                                                ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immunosuppression               ///
>                         i.stp
. estimates save ./analysis/output/models/an_imputed_full_`dataset'`sensan'_`outcome'_`agetype', replace
. }

. 
. log close
      name:  <unnamed>
       log:  E:\analyses\covid-vs-noncovid-deaths-research\analysis/output/an_imputed_GENERAL_MAINSA_censorendAug_coviddeath_agesex_agespl.log
  log type:  text
 closed on:  22 Feb 2021, 17:23:00
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
